# ゲームシステム仕様

> このドキュメントは `public/js/` 内の実装と対応しています。
> コードを変更した場合は、このドキュメントも更新してください。

## ゲーム設定（CONFIG）

> 定義ファイル: `public/js/config.js`

| 項目 | 値 | 説明 |
|------|-----|------|
| CANVAS_WIDTH | 動的 | ウィンドウ幅に合わせて調整 |
| CANVAS_HEIGHT | 動的 | ウィンドウ高さに合わせて調整 |
| WORLD_SIZE | 2000px | ゲームワールドの大きさ |
| GAME_DURATION | 10分（デフォルト） | 選択可能: 3/5/10/15分 |
| PLAYER_SPEED | 3 | プレイヤー基本移動速度 |
| PLAYER_MAX_HP | 100 | プレイヤー最大HP |

---

## レベルアップシステム

### 経験値計算

```javascript
XP_TO_LEVEL = level => Math.floor(10 * Math.pow(1.2, level - 1))
```

| レベル | 必要XP |
|--------|--------|
| 1→2 | 10 |
| 2→3 | 12 |
| 3→4 | 14 |
| 4→5 | 17 |
| 5→6 | 21 |
| 10→11 | 52 |
| 20→21 | 320 |

### レベルアップ時の選択

1. 3つの選択肢がランダムに提示される
2. 選択肢の内容:
   - 未取得の武器（NEW!）
   - 取得済み武器のレベルアップ（Lv.1→2など）
   - パッシブアイテム（重複取得可能、最大5回）

### 制限

- 武器: 最大レベル8
- パッシブ: 最大5スタック

---

## ウェーブシステム

> 定義ファイル: `public/js/config.js`, `public/js/game.js`

### 設定値

| 項目 | 値 | 説明 |
|------|-----|------|
| WAVE_INTERVAL | 30秒 | ウェーブ発生間隔 |
| WAVE_BASE_ENEMIES | 15体 | 最初のウェーブの敵数 |
| WAVE_ENEMIES_INCREMENT | 8体 | ウェーブごとの増加数 |
| WAVE_WARNING_TIME | 3秒 | 予告表示時間 |

### ウェーブごとの敵数

```
敵数 = 15 + (ウェーブ番号 - 1) × 8
```

| ウェーブ | 敵数 |
|----------|------|
| 1 | 15 |
| 2 | 23 |
| 3 | 31 |
| 4 | 39 |
| 5 | 47 |

### ウェーブ敵の出現傾向

- ウェーブ2以降: ウイルスが40%の確率で出現
- ウェーブ3以降: バクテリアが30%の確率で出現

---

## プレイヤー仕様

> 定義ファイル: `public/js/entities.js` - `Player` クラス

### 基本ステータス

| 項目 | 初期値 |
|------|--------|
| HP | 100 |
| サイズ | 20px |
| 速度 | 3 |
| 初期武器 | 抗体 Lv.1 |

### 乗算ステータス（パッシブで変化）

| 項目 | 初期値 | 影響 |
|------|--------|------|
| damageMultiplier | 1.0 | 全武器のダメージ |
| xpMultiplier | 1.0 | XP取得量 |
| defenseMultiplier | 0.0 | 被ダメージ軽減率 |
| speedMultiplier | 1.0 | 移動速度 |
| cooldownMultiplier | 1.0 | 武器クールダウン |

### 無敵時間

- 被ダメージ後: 500ms の無敵時間
- 無敵中は点滅表示

---

## XPオーブシステム

### 吸引範囲

```javascript
collectRange = 100 + player.level × 5
```

- レベル1: 105px
- レベル10: 150px
- レベル20: 200px

### 吸引速度

```javascript
speed = max(5, 15 - distance / 20)
```

- 遠い場合: 遅くゆっくり吸い込む
- 近い場合: 速く吸い込む

### 回収判定

プレイヤーサイズ（20px）内に入ると回収

---

## カメラシステム

プレイヤーを常に画面中央に配置：

```javascript
camera.x = player.x;
camera.y = player.y;

// 描画時の座標変換
screenX = worldX - camera.x + CANVAS_WIDTH / 2;
screenY = worldY - camera.y + CANVAS_HEIGHT / 2;
```

---

## ゲーム状態

| 状態 | 説明 |
|------|------|
| `start` | スタート画面表示中 |
| `playing` | ゲームプレイ中 |
| `levelup` | レベルアップメニュー表示中（ゲーム一時停止） |
| `gameover` | ゲームオーバー or クリア画面 |

---

## 勝敗条件

### 勝利条件
- タイマーが0になるまで生存

### 敗北条件
- プレイヤーHPが0以下になる

---

## 操作方法

### キーボード
- 移動: WASD または 矢印キー

### モバイル（画面幅600px以下）
- 画面左下のバーチャルジョイスティック
- 最大移動距離35pxで正規化

---

## 実装ファイル

- ゲーム設定: `public/js/config.js`
- ゲームループ: `public/js/game.js` - `update()`, `draw()`
- プレイヤー: `public/js/entities.js` - `Player` クラス
- 状態管理: `public/js/state.js`
- サウンド: `public/js/sound.js`
