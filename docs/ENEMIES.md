# 敵キャラクター仕様

> このドキュメントは `public/js/weapons.js` の `ENEMY_TYPES` と対応しています。
> コードを変更した場合は、このドキュメントも更新してください。

## 敵一覧

### 雑菌（Germ）

| 項目 | 値 |
|------|-----|
| 見た目 | 緑のつぶつぶ（12角形） |
| 色 | #2ecc71 |
| サイズ | 12px |
| HP | 15 |
| 移動速度 | 1 |
| 接触ダメージ | 5 |
| 経験値 | 3 |

**特徴**: 最も基本的な敵。大量に出現する。

**出現条件**: ゲーム開始時から出現

---

### ウイルス（Virus）

| 項目 | 値 |
|------|-----|
| 見た目 | 赤い丸（トゲ付き） |
| 色 | #e74c3c |
| サイズ | 10px |
| HP | 8 |
| 移動速度 | 2.5 |
| 接触ダメージ | 8 |
| 経験値 | 5 |

**特徴**: 素早いが低体力。回避が難しい。

**出現条件**: ゲーム進行10%以降（約1分後）

---

### バクテリア（Bacteria）

| 項目 | 値 |
|------|-----|
| 見た目 | 棒状（角丸長方形） |
| 色 | #9b59b6 |
| サイズ | 20px |
| 横幅 | 30px |
| 縦幅 | 12px |
| HP | 40 |
| 移動速度 | 0.8 |
| 接触ダメージ | 12 |
| 経験値 | 10 |

**特徴**: 体力が多く倒しにくい。ゆっくり近づいてくる。

**出現条件**: ゲーム進行30%以降（約3分後）

---

### 胞子（Spore）

| 項目 | 値 |
|------|-----|
| 見た目 | オレンジの球体（周囲に小胞子） |
| 色 | #f39c12 |
| サイズ | 14px |
| HP | 25 |
| 移動速度 | 0.6 |
| 接触ダメージ | 5 |
| 経験値 | 8 |
| 攻撃タイプ | 遠距離 |
| 攻撃射程 | 200px |
| 好む距離 | 150px |
| 攻撃間隔 | 2000ms |
| 弾速 | 3 |
| 弾ダメージ | 10 |
| 弾サイズ | 6px |
| 弾の色 | #e67e22 |

**特徴**: 遠距離攻撃をする敵。一定距離を保ちながら弾を発射する。近づくと後退する。

**出現条件**: ゲーム進行20%以降（約2分後）

---

### 癌細胞（Cancer）

| 項目 | 値 |
|------|-----|
| 見た目 | ピンクの不規則な形（複数の核） |
| 色 | #ff69b4 |
| サイズ | 16px |
| HP | 35 |
| 移動速度 | 0.9 |
| 接触ダメージ | 8 |
| 経験値 | 12 |
| 特殊能力 | 分裂 |
| 分裂条件 | HP50%以下 |
| 分裂数 | 2体 |

**特徴**: HPが半分以下になると2体に分裂する。分裂した個体は元より小さく、HP・ダメージも減少している。

**科学的背景**: 癌細胞は無限増殖能を持つ異常細胞。アポトーシス（細胞死）を回避し、分裂を続けることで腫瘍を形成する。

**出現条件**: ゲーム進行25%以降

---

### 寄生虫（Parasite）

| 項目 | 値 |
|------|-----|
| 見た目 | 金色のワーム状 |
| 色 | #ffd700 |
| サイズ | 12px |
| HP | 20 |
| 移動速度 | 1.8 |
| 接触ダメージ | 6 |
| 経験値 | 7 |
| 特殊能力 | 回避 |
| 回避距離 | 80px |
| 回避クールダウン | 2000ms |
| 回避速度 | 6 |

**特徴**: ダメージを受けると素早く回避行動を取る。攻撃を当てにくい厄介な敵。

**科学的背景**: 寄生虫は宿主の免疫システムを巧みに回避する。表面抗原を変化させたり、免疫抑制物質を分泌して生存する。

**出現条件**: ゲーム進行35%以降

---

### 自爆細菌（Exploder）

| 項目 | 値 |
|------|-----|
| 見た目 | 緑の毒々しい球体 |
| 色 | #00ff00 |
| サイズ | 14px |
| HP | 18 |
| 移動速度 | 1.5 |
| 接触ダメージ | 5 |
| 経験値 | 6 |
| 特殊能力 | 死亡時爆発 |
| 爆発範囲 | 60px |
| 爆発ダメージ | 25 |
| 爆発遅延 | 500ms |

**特徴**: 死亡時に爆発し、プレイヤーにダメージを与える。倒す際は距離を取る必要がある。

**科学的背景**: 一部の細菌は死滅時に毒素や消化酵素を放出する。この自己犠牲的な戦略は群れ全体の生存率を高める。

**出現条件**: ゲーム進行40%以降

---

## 敵のスケーリング

### 時間経過によるHP補正

敵のHPはゲーム進行に応じてスケールします：

```
実際のHP = 基本HP × (1 + progress × 2)
```

- `progress` = 経過時間 / ゲーム時間
- 例: 5分経過（10分ゲーム）の場合、progress = 0.5
  - HP倍率 = 1 + 0.5 × 2 = 2倍

### ウェーブ時の追加補正

ウェーブで出現する敵は追加でHP補正を受けます：

```
実際のHP = 基本HP × (1 + progress × 2) × (1 + waveNumber × 0.1)
```

- ウェーブ1: +10%
- ウェーブ2: +20%
- ウェーブ3: +30%
- ...

---

## 敵の行動パターン

### 近接型（germ, virus, bacteria）

1. **移動**: プレイヤーに向かって直線的に移動
2. **攻撃**: プレイヤーとの接触時にダメージを与える
3. **死亡**: HPが0になるとXPオーブをドロップ

```javascript
// 移動ロジック（entities.js より）
const dx = player.x - this.x;
const dy = player.y - this.y;
const dist = Math.hypot(dx, dy);
this.x += (dx / dist) * this.speed;
this.y += (dy / dist) * this.speed;
```

### 遠距離型（spore）

1. **移動**:
   - 射程外の場合：プレイヤーに向かって移動
   - 好む距離より近い場合：プレイヤーから離れる（後退）
   - 射程内の場合：その場で停止
2. **攻撃**: 射程内でクールダウン完了後、プレイヤーに向かって弾を発射
3. **接触ダメージ**: 接触時にも少量のダメージを与える
4. **死亡**: HPが0になるとXPオーブをドロップ

```javascript
// 遠距離攻撃ロジック（entities.js より）
if (dist <= this.attackRange && now - this.lastAttack > this.attackCooldown) {
    this.lastAttack = now;
    const angle = Math.atan2(dy, dx);
    enemyProjectiles.push({
        x: this.x, y: this.y,
        vx: Math.cos(angle) * this.projectileSpeed,
        vy: Math.sin(angle) * this.projectileSpeed,
        damage: this.projectileDamage,
        // ...
    });
}
```

### 分裂型（cancer）

1. **移動**: プレイヤーに向かって直線的に移動
2. **分裂**: HPが50%以下になると2体に分裂
   - 分裂後の個体は元より小さい（サイズ70%）
   - HP・ダメージも減少（HP60%、ダメージ70%）
   - 分裂した個体は再度分裂しない
3. **死亡**: HPが0になるとXPオーブをドロップ

### 回避型（parasite）

1. **移動**: プレイヤーに向かって素早く移動
2. **回避**: ダメージを受けると回避行動を発動
   - ランダムな方向に高速ダッシュ（200ms）
   - クールダウン2秒間は再発動しない
3. **死亡**: HPが0になるとXPオーブをドロップ

### 自爆型（exploder）

1. **移動**: プレイヤーに向かって高速で移動
2. **死亡トリガー**: HPが0になると爆発カウントダウン開始
   - 500ms後に爆発
   - カウントダウン中は移動停止、点滅
3. **爆発**: 範囲内のプレイヤーにダメージ
   - ダメージは距離に応じて減衰
   - 爆発後にXPオーブをドロップ

---

## スポーン仕様

### 通常スポーン

- スポーン間隔: `1000ms - min(経過時間/1000, 800)ms`
  - 開始時: 約1秒に1体
  - 終盤: 約0.2秒に1体
- スポーン位置: プレイヤーから画面外（約100px外側）
- スポーン角度: ランダム（360度）

### ウェーブスポーン

- 発生間隔: 30秒ごと
- 予告: 3秒前に警告表示
- 基本敵数: 15体
- 増加数: ウェーブごとに+8体
- スポーン配置: プレイヤーを囲む円形

---

## 実装ファイル

- 敵定義: `public/js/weapons.js` - `ENEMY_TYPES` オブジェクト
- 敵クラス: `public/js/entities.js` - `Enemy` クラス
- 敵の弾: `public/js/state.js` - `enemyProjectiles` 配列
- スポーンロジック: `public/js/game.js` - `spawnEnemy()`, `spawnWave()`
- 弾の更新・描画: `public/js/game.js` - `update()`, `draw()`
- 描画処理: `public/js/entities.js` - `Enemy.draw()`
